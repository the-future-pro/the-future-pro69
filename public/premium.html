<!doctype html>
<html lang="ro">
<head>
<meta charset="utf-8">
<title>Premium</title>
<link rel="stylesheet" href="/style.css">
<style>
.wrap{max-width:1100px;margin:0 auto;padding:24px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
.card{border:1px solid #333;border-radius:12px;padding:12px;background:#0b0b0f}
small.mono{font-family:monospace;opacity:.8}
.blurred{filter:blur(14px)}
</style>
</head>
<body class="wrap">
  <h1>Premium</h1>

  <div class="card">
    <h3>Login</h3>
    <input id="email" placeholder="email" style="width:260px">
    <button onclick="doLogin()">Login</button>
    <pre id="meBox" style="white-space:pre-wrap"></pre>
  </div>

  <div class="card">
    <h3>Verifică & Abonează-te (mock)</h3>
    <button onclick="mockSub('BASIC')">BASIC</button>
    <button onclick="mockSub('PLUS')">PLUS</button>
    <button onclick="mockSub('PRO')">PRO</button>
    <p><small class="mono">Setează abonamentul în contul tău de test. Pe live vei conecta Stripe.</small></p>
  </div>

  <div class="card" id="createBox" style="display:none">
    <h3>Creează un Partener AI</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px">
      <input id="p_name" placeholder="Nume (ex. Vanesa Maria)">
      <select id="p_type">
        <option value="female">Femeie</option>
        <option value="male">Bărbat</option>
        <option value="anime">Anime</option>
      </select>
      <select id="p_role">
        <option>Asistentă medicală</option>
        <option>Profesoară</option>
        <option>Secretară</option>
        <option>Asistentă birou</option>
        <option>Girlfriend</option>
        <option>Goth</option>
        <option>MILF</option>
        <option>Boyfriend</option>
        <option>CEO/Boss</option>
        <option>Personal Trainer</option>
        <option>Catgirl</option>
        <option>Elf Queen</option>
      </select>
      <input id="p_category" placeholder="Categorie (ex. Roleplay)">
      <input id="p_tone" placeholder="Ton (ex. tandră, pasională)">
      <input id="p_img" type="number" placeholder="Preț imagine (credite)" value="20">
      <input id="p_v10" type="number" placeholder="Preț video 10s (credite)" value="90">
      <input id="p_v20" type="number" placeholder="Preț video 20s (credite)" value="150">
    </div>
    <button onclick="createPersona()">Creează</button>
    <div id="createMsg"></div>
  </div>

  <h3 style="margin-top:24px">Parteneri AI disponibili</h3>
  <div id="list" class="grid"></div>

<script>
const j = (u, o)=>fetch(u,{method:o?.method||'GET',headers:{'Content-Type':'application/json'},credentials:'include',body:o?.body?JSON.stringify(o.body):undefined}).then(r=>r.json());

async function refreshMe(){
  const me = await j('/api/me');
  document.getElementById('meBox').textContent = JSON.stringify(me,null,2);
  document.getElementById('createBox').style.display = (me.logged && me.subActive)?'block':'none';
}
async function doLogin(){
  const email = document.getElementById('email').value.trim();
  if(!email) return alert('Email!');
  await j('/api/login',{method:'POST',body:{email}});
  refreshMe(); loadPersonas();
}
async function mockSub(tier){ await j('/api/sub/mock-activate',{method:'POST',body:{tier}}); refreshMe(); }

async function createPersona(){
  const body = {
    name: p_name.value.trim(),
    type: p_type.value,
    role: p_role.value,
    category: p_category.value.trim()||'Roleplay',
    tone: p_tone.value.trim(),
    mediaPrices: { image:Number(p_img.value||20), video10:Number(p_v10.value||90), video20:Number(p_v20.value||150) }
  };
  const r = await j('/api/personas',{method:'POST',body});
  document.getElementById('createMsg').textContent = JSON.stringify(r);
  if(r.ok) loadPersonas();
}
async function loadPersonas(){
  const r = await j('/api/personas');
  const el = document.getElementById('list');
  el.innerHTML = '';
  (r.items||[]).forEach(p=>{
    const d = document.createElement('div');
    d.className='card';
    d.innerHTML = `
      <div><b>${p.name}</b> — <small>${p.type}/${p.role}</small></div>
      <div style="margin:6px 0"><small class="mono">Slug: ${p.slug}</small></div>
      <a href="/chat.html?slug=${encodeURIComponent(p.slug)}">Deschide chat</a>
    `;
    el.appendChild(d);
  });
}
refreshMe(); loadPersonas();
</script>
</body>
</html>
